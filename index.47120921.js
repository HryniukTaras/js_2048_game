function t(t){return t&&t.__esModule?t.default:t}var e={};const s=new(t(e=class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=t.map(t=>[...t]),this.previousState=this.state.map(t=>[...t]),this.score=0,this.gameOver=!1}static getEmptyCells(t){return t.flat().filter(t=>0===t)}moveLeft(){this.#t(!1,!1)}moveRight(){this.#t(!1,!0)}moveUp(){this.#t(!0,!1)}moveDown(){this.#t(!0,!0)}#t(t=!1,e=!1){if("playing"!==this.getStatus()||"win"===this.getStatus())return;this.previousState=this.state.map(t=>[...t]);let s=!1;for(let r=0;r<4;r++){let a=this.#e(r,t,e),i=this.#s(a);this.#r(r,i,t,e)&&(s=!0)}s&&(this.#a(),this.hasPossibleMoves()||(this.gameOver=!0))}#e(t,e,s){let r=[];for(let a=0;a<4;a++){let i=e?this.state[s?3-a:a][t]:this.state[t][s?3-a:a];0!==i&&r.push(i)}return r}#s(t){let e=[];for(;t.length>0;){let s=t.shift();if(t.length>0&&s===t[0]){let r=s+t.shift();e.push(r),this.#i(r)}else e.push(s)}for(;e.length<4;)e.push(0);return e}#r(t,e,s,r){let a=!1;for(let i=0;i<4;i++)(s?this.state[r?3-i:i][t]:this.state[t][r?3-i:i])!==e[i]&&(a=!0,s?this.state[r?3-i:i][t]=e[i]:this.state[t][r?3-i:i]=e[i]);return a}getScore(){return this.score}#i(t=0){return this.score+=t,this.score}getState(){return this.state}getPreviousState(){return this.previousState}getStatus(){return JSON.stringify(this.state)===JSON.stringify(this.initialState)?"idle":this.state.flat().includes(2048)?"win":this.gameOver?"lose":"playing"}start(){this.previousState=this.state.map(t=>[...t]),this.#a(),this.#a()}restart(){this.previousState=this.state.map(t=>[...t]),this.state=this.initialState.map(t=>[...t]),this.score=0,this.gameOver=!1}hasPossibleMoves(){if(this.state.flat().includes(0))return!0;for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e])return!0}return!1}#a(){let t,e;do t=Math.floor(4*Math.random()),e=Math.floor(4*Math.random());while(0!==this.state[t][e])this.state[t][e]=10>Math.floor(100*Math.random())?4:2}}));let r=!0;const a=()=>{let t=s.getState(),e=s.getPreviousState(),a=t.reduce((t,s,a)=>(s.forEach((s,i)=>{(r||s!==e[a][i])&&t.push({rowIndex:a,cellIndex:i,newValue:s})}),t),[]);return r&&(r=!1),a},i=()=>{let r=document.querySelectorAll(".field-row"),i=a(),o=16===t(e).getEmptyCells(s.getState()).length;i.forEach(({rowIndex:t,cellIndex:e,newValue:s})=>{let a=r[t].querySelectorAll(".field-cell")[e];a.className="field-cell",a.textContent=o||0===s?"":s,o||0===s||a.classList.add(`field-cell--${s}`)});let l=s.getScore();document.querySelector(".game-score").textContent=l},o=t=>{let e={lose:document.querySelector(".message-lose"),win:document.querySelector(".message-win"),idle:document.querySelector(".message-start")};Object.values(e).forEach(t=>{t.classList.add("hidden")}),e[t]&&e[t].classList.remove("hidden"),"idle"===t&&(n.classList.remove("restart"),n.classList.add("start"),n.textContent="Start"),"playing"===t&&(n.classList.remove("start"),n.classList.add("restart"),n.textContent="Restart"),"lose"===t&&document.removeEventListener("keydown",l),"win"===t&&document.removeEventListener("keydown",l)},l=t=>{let e=t.key,r={ArrowUp:()=>s.moveUp(),ArrowDown:()=>s.moveDown(),ArrowLeft:()=>s.moveLeft(),ArrowRight:()=>s.moveRight()};r[e]&&(r[e](),i(),o(s.getStatus()))},n=document.querySelector(".start");let h=!1;n.addEventListener("click",()=>{if(!(h=!h)){s.restart(),i(),o(s.getStatus()),document.removeEventListener("keydown",l);return}s.start(),i(),o(s.getStatus()),document.addEventListener("keydown",l)});
//# sourceMappingURL=index.47120921.js.map
